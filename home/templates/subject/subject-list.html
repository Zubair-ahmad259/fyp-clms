{% extends 'Home/base.html' %}
{% load static %}

{% block body %}
<div class="page-wrapper">
    <div class="content container-fluid">
        <div class="page-header">
            <div class="row align-items-center">
                <div class="col">
                    <h3 class="page-title">Subjects</h3>
                    <ul class="breadcrumb">
                        <li class="breadcrumb-item active">Subjects</li>
                    </ul>
                </div>
                <div class="col-auto text-right float-right ml-auto">
                    <a href="{% url 'subjects:add_subject' %}" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Add Subject
                    </a>
                </div>
            </div>
        </div>

        <!-- Filter Card -->
        <div class="row mb-4">
            <div class="col-sm-12">
                <div class="card">
                    <div class="card-body">
                        <form method="get" action="{% url 'subjects:view_subject' %}">
                            <div class="row">
                              <!-- In the filter card section -->
<div class="col-md-4">
    <div class="form-group">
        <label>Semester</label>
        <select class="form-control" name="semester">
            <option value="">All Semesters</option>
            <option value="1" {% if request.GET.semester == "1" %}selected{% endif %}>Semester 1</option>
            <option value="2" {% if request.GET.semester == "2" %}selected{% endif %}>Semester 2</option>
            <option value="3" {% if request.GET.semester == "3" %}selected{% endif %}>Semester 3</option>
            <option value="4" {% if request.GET.semester == "4" %}selected{% endif %}>Semester 4</option>
            <option value="5" {% if request.GET.semester == "5" %}selected{% endif %}>Semester 5</option>
            <option value="6" {% if request.GET.semester == "6" %}selected{% endif %}>Semester 6</option>
            <option value="7" {% if request.GET.semester == "7" %}selected{% endif %}>Semester 7</option>
            <option value="8" {% if request.GET.semester == "8" %}selected{% endif %}>Semester 8</option>
        </select>
    </div>
</div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label>Subject Type</label>
                                        <select class="form-control" name="subject_type">
                                            <option value="">All Types</option>
                                            {% for value, name in subject_type_choices %}
                                            <option value="{{ value }}" {% if request.GET.subject_type == value %}selected{% endif %}>{{ name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                 <div class="col-sm-6 col-md-3">
   <div class="form-group form-focus">
    <label class="focus-label">Discipline</label>
    <select class="form-control" name="discipline" id="discipline" onchange="this.form.submit()">
        <option value="">All Disciplines</option>
        {% for discipline in disciplines %}
            <option value="{{ discipline.id }}" 
                {% if selected_discipline and selected_discipline.id == discipline.id %}
                    selected
                {% endif %}>
                {{ discipline.field }} ({{ discipline.program }})
            </option>
        {% endfor %}
    </select>
</div>

            </div>

                                
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label>Status</label>
                                        <select class="form-control" name="is_active">
                                            <option value="">All Statuses</option>
                                            <option value="true" {% if request.GET.is_active == "true" %}selected{% endif %}>Active</option>
                                            <option value="false" {% if request.GET.is_active == "false" %}selected{% endif %}>Inactive</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-12 text-right">
                                    <button type="submit" class="btn btn-primary mr-2">
                                        <i class="fas fa-filter"></i> Filter
                                    </button>
                                    <a href="{% url 'subjects:view_subject' %}" class="btn btn-secondary">
                                        <i class="fas fa-sync-alt"></i> Reset
                                    </a>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-sm-12">
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover table-center mb-0">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Subject Name</th>
                                        <th>Subject Code</th>
                                        <th>Semester</th>
                                        <th>Credit Hours</th>
                                        <th>Type</th>
                                        <th>Status</th>
                                        <th class="text-right">Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for subject in subjects %}
                                    <tr>
                                        <td>{{ forloop.counter }}</td>
                                        <td>
                                            <h5 class="mb-0">{{ subject.name }}</h5>
                                            {% if subject.description %}
                                            <small class="text-muted">{{ subject.description|truncatechars:30 }}</small>
                                            {% endif %}
                                        </td>
                                        <td>{{ subject.code }}</td>
                                        <td>{{ subject.get_semester_display }}</td>
                                        <td>{{ subject.credit_hours }}</td>
                                        <td>
                                            <span class="badge {% if subject.subject_type == 'core' %}badge-primary{% else %}badge-info{% endif %}">
                                                {{ subject.get_subject_type_display }}
                                            </span>
                                        </td>
                                        <td>
                                            <span class="badge {% if subject.is_active %}badge-success{% else %}badge-danger{% endif %}">
                                                {% if subject.is_active %}Active{% else %}Inactive{% endif %}
                                            </span>
                                        </td>
                                        <td class="text-right">
                                            <div class="actions">
                                                {% comment %} <a href="{% url 'edit_subject' subject.id %}" class="btn btn-sm bg-success-light mr-2"> {% endcomment %}
                                                    <i class="fas fa-pen"></i>
                                                </a>
                                                {% comment %} <a href="{% url 'delete_subject' subject.id %}" class="btn btn-sm bg-danger-light" onclick="return confirm('Are you sure you want to delete this subject?');"> {% endcomment %}
                                                    <i class="fas fa-trash"></i>
                                                </a>
                                            </div>
                                        </td>
                                    </tr>
                                    {% empty %}
                                    <tr>
                                        <td colspan="8" class="text-center text-muted">No subjects found. <a href="{% url 'subjects:add_subject' %}">Add your first subject</a></td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>

                        {% if subjects.has_other_pages %}
                        <div class="mt-3">
                            <nav aria-label="Page navigation">
                                <ul class="pagination justify-content-center">
                                    {% if subjects.has_previous %}
                                    <li class="page-item">
                                        <a class="page-link" href="?page={{ subjects.previous_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}" aria-label="Previous">
                                            <span aria-hidden="true">&laquo;</span>
                                        </a>
                                    </li>
                                    {% else %}
                                    <li class="page-item disabled">
                                        <a class="page-link" href="#" aria-label="Previous">
                                            <span aria-hidden="true">&laquo;</span>
                                        </a>
                                    </li>
                                    {% endif %}
                                    
                                    {% for i in subjects.paginator.page_range %}
                                    {% if subjects.number == i %}
                                    <li class="page-item active"><a class="page-link" href="#">{{ i }}</a></li>
                                    {% else %}
                                    <li class="page-item"><a class="page-link" href="?page={{ i }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">{{ i }}</a></li>
                                    {% endif %}
                                    {% endfor %}
                                    
                                    {% if subjects.has_next %}
                                    <li class="page-item">
                                        <a class="page-link" href="?page={{ subjects.next_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}" aria-label="Next">
                                            <span aria-hidden="true">&raquo;</span>
                                        </a>
                                    </li>
                                    {% else %}
                                    <li class="page-item disabled">
                                        <a class="page-link" href="#" aria-label="Next">
                                            <span aria-hidden="true">&raquo;</span>
                                        </a>
                                    </li>
                                    {% endif %}
                                </ul>
                            </nav>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .badge {
        font-size: 12px;
        font-weight: 500;
        padding: 5px 10px;
        border-radius: 4px;
    }
    .badge-primary {
        background-color: #4e73df;
        color: white;
    }
    .badge-info {
        background-color: #36b9cc;
        color: white;
    }
    .badge-success {
        background-color: #1cc88a;
        color: white;
    }
    .badge-danger {
        background-color: #e74a3b;
        color: white;
    }
    .actions a {
        display: inline-block;
        width: 30px;
        height: 30px;
        line-height: 30px;
        text-align: center;
        border-radius: 4px;
    }
    .bg-success-light {
        background-color: rgba(28, 200, 138, 0.1);
        color: #1cc88a;
    }
    .bg-danger-light {
        background-color: rgba(231, 74, 59, 0.1);
        color: #e74a3b;
    }
</style>
{% endblock %}